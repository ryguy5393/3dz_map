<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ZIP Code Mapper</title>
    <style>
        body, html {
            margin: 0;
            padding: 0;
            height: 100%;
            width: 100%;
            background-color: black;
            color: white;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
        }
        #container {
            position: relative;
            width: 90%;
            height: 90%;
        }
        #controls {
            position: absolute;
            top: 10px;
            left: 10px;
            z-index: 5;
            background: white;
            padding: 10px;
            border-radius: 5px;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.3);
            color: black;
        }
        #map {
            width: 100%;
            height: 100%;
        }
        #infoBox {
            margin-top: 10px;
            font-size: 14px;
            max-height: 100px;
            overflow-y: auto;
            border: 1px solid #ccc;
            padding: 5px;
            border-radius: 3px;
            background: #f9f9f9;
            color: black;
        }
        button, select {
            margin-top: 5px;
            padding: 5px;
        }
    </style>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDmPeFZJYVUi-_u5s7ZmFT5Swbr2OM0GoI"></script>
</head>
<body>
    <div id="container">
        <div id="controls">
            <input id="searchBox" type="text" placeholder="Enter ZIP(s) (e.g., 123,456)">
            <button id="clearButton">Clear Selections</button>
            <button id="toggleZipView">Switch to 5-Digit ZIPs</button>
            <div>
                <label for="carrierSelect">Select Carrier:</label>
                <select id="carrierSelect">
                    <option value="">None</option>
                    <option value="CarrierA">Carrier A</option>
                </select>
            </div>
            <input id="laneSearch" type="text" placeholder="Search Lane (e.g., 123-456)">
            <div id="infoBox">Selected ZIPs will appear here.</div>
        </div>
        <div id="map"></div>
    </div>

    <script>
        let map;
        let selectedZips = [];
        let currentGeoJSON = "https://raw.githubusercontent.com/ryguy5393/3dz_map/main/3_digit_zip_boundaries.geojson";
        let isThreeDigitView = true;
        let carrierData = {
            "CarrierA": [
                { origin: "123", dest: "456", rate: "$2.50" },
                { origin: "789", dest: "321", rate: "$3.10" }
            ]
        };

        function initMap() {
            map = new google.maps.Map(document.getElementById("map"), {
                zoom: 4,
                center: { lat: 39.8283, lng: -98.5795 },
                mapTypeControl: true,
                mapTypeControlOptions: { style: google.maps.MapTypeControlStyle.HORIZONTAL_BAR, position: google.maps.ControlPosition.BOTTOM_LEFT },
                fullscreenControl: true,
                fullscreenControlOptions: { position: google.maps.ControlPosition.BOTTOM_LEFT },
            });

            loadGeoJSON(currentGeoJSON);

            document.getElementById("toggleZipView").addEventListener("click", toggleZipView);
            document.getElementById("searchBox").addEventListener("change", batchSearch);
            document.getElementById("clearButton").addEventListener("click", clearSelections);
            document.getElementById("carrierSelect").addEventListener("change", highlightCarrierZips);
            document.getElementById("laneSearch").addEventListener("change", searchLane);
        }

        function loadGeoJSON(url) {
            map.data.forEach(feature => map.data.remove(feature)); // Clear previous data
            map.data.loadGeoJson(url); // Load new GeoJSON
            map.data.setStyle({ fillColor: "blue", fillOpacity: 0.1, strokeColor: "black", strokeWeight: 1 });

            map.data.addListener("mouseover", event => {
                const zip = event.feature.getProperty(isThreeDigitView ? "ZIP3" : "ZIP5");
                if (zip) {
                    const tooltip = document.createElement("div");
                    tooltip.id = "tooltip";
                    tooltip.style.position = "absolute";
                    tooltip.style.backgroundColor = "white";
                    tooltip.style.color = "black";
                    tooltip.style.border = "1px solid black";
                    tooltip.style.padding = "5px";
                    tooltip.style.borderRadius = "5px";
                    tooltip.style.pointerEvents = "none";
                    tooltip.style.top = `${event.domEvent.pageY + 10}px`;
                    tooltip.style.left = `${event.domEvent.pageX + 10}px`;
                    tooltip.textContent = `ZIP: ${zip}`;
                    document.body.appendChild(tooltip);
                }
            });

            map.data.addListener("mouseout", () => {
                const tooltip = document.getElementById("tooltip");
                if (tooltip) document.body.removeChild(tooltip);
            });
        }

        function toggleZipView() {
            isThreeDigitView = !isThreeDigitView;
            currentGeoJSON = isThreeDigitView ? 
                "https://raw.githubusercontent.com/ryguy5393/3dz_map/main/3_digit_zip_boundaries.geojson" :
                "https://storage.googleapis.com/geojson_5dz_data/usa_zip_codes_geo_100m%20(2).json";
            document.getElementById("toggleZipView").textContent = isThreeDigitView ? "Switch to 5-Digit ZIPs" : "Switch to 3-Digit ZIPs";
            loadGeoJSON(currentGeoJSON); // Reload data based on current view
        }

        function batchSearch() {
            const zipCodes = document.getElementById("searchBox").value.split(",").map(z => z.trim());
            zipCodes.forEach(zip => highlightZip(zip));
        }

        function highlightZip(zip) {
            map.data.forEach(feature => {
                if (feature.getProperty(isThreeDigitView ? "ZIP3" : "ZIP5") === zip) {
                    map.data.overrideStyle(feature, { fillColor: "red", fillOpacity: 0.4 });
                    if (!selectedZips.includes(zip)) selectedZips.push(zip);
                }
            });
            updateInfoBox();
        }

        function highlightCarrierZips() {
            clearSelections();
            const carrier = document.getElementById("carrierSelect").value;
            if (!carrier) return;
            carrierData[carrier].forEach(data => { highlightZip(data.origin); highlightZip(data.dest); });
        }

        function searchLane() {
            const [orig, dest] = document.getElementById("laneSearch").value.split("-");
            const carrier = document.getElementById("carrierSelect").value;
            const rate = carrierData[carrier]?.find(r => r.origin === orig && r.dest === dest)?.rate || "No data";
            alert(`Rate for ${orig}-${dest}: ${rate}`);
        }

        function clearSelections() {
            map.data.forEach(feature => map.data.overrideStyle(feature, { fillColor: "blue", fillOpacity: 0.1 }));
            selectedZips = [];
            updateInfoBox();
        }

        function updateInfoBox() {
            document.getElementById("infoBox").innerText = selectedZips.length ? "Selected ZIPs: " + selectedZips.join(", ") : "No ZIP codes selected.";
        }

        window.onload = initMap;
    </script>
</body>
</html>
